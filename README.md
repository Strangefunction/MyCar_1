AGV 小车自动导航系统 - README
项目概述
本项目基于 STM32F103ZET6 主控芯片开发一款具备自主导航能力的 AGV 小车，核心功能为接收上位机通过 LoRa 下发的目标位置信息，结合 UWB 定位、MPU6050 姿态检测数据，通过 A * 算法完成路径规划，并基于串级 PID 算法实现电机的速度 / 位置闭环控制，最终实现小车的精准自动导航，配套 OLED 显示屏实时展示小车状态。
硬件清单
模块	型号 / 规格	功能说明
主控芯片	STM32F103ZET6	核心控制，算法运算，外设驱动
定位模块	UWB（主控 GD32）	实时获取小车精准位置坐标
电机	520 直流电机 × 4	小车动力输出
电机驱动	AT8236	接收主控指令驱动电机运转
显示模块	OLED（IIC 通信）	显示小车位置、状态、路径等信息
无线通讯	LoRa 模块	与上位机双向数据交互
姿态检测	MPU6050（陀螺仪 + 加速度计）	检测小车姿态、角速度、加速度
软件架构
核心功能模块
LoRa

上位机

STM32主控

数据解析模块

UWB定位模块

MPU6050姿态模块

A*路径规划算法

串级PID控制模块

AT8236电机驱动

520电机

OLED显示模块

LoRa

上位机

STM32主控

数据解析模块

UWB定位模块

MPU6050姿态模块

A*路径规划算法

串级PID控制模块

AT8236电机驱动

520电机

OLED显示模块


豆包
你的 AI 助手，助力每日工作学习
关键算法
A * 路径规划算法：基于上位机下发的目标位置和 UWB 实时定位的当前位置，规划最优行驶路径，输出路径节点坐标。
串级 PID 控制：
外环（位置环）：根据路径规划的目标位置与实际位置偏差，输出目标速度；
内环（速度环）：根据目标速度与电机实际速度偏差，输出电机 PWM 占空比，实现精准调速。
快速上手
环境准备
开发工具：Keil MDK-ARM V5.x（需安装 STM32F103 芯片包）
烧录工具：ST-Link V2（或 J-Link）
依赖库：
STM32F1xx HAL 库
MPU6050 驱动库（IIC 通信）
UWB 通信协议库（与 GD32 主控交互）
LoRa 无线通信驱动库
OLED IIC 驱动库
编译与烧录
克隆 / 下载项目代码至本地，用 Keil MDK 打开工程文件（.uvprojx）；
确认工程中芯片型号为STM32F103ZET6，检查外设引脚配置与硬件实际接线一致；
编译工程，确认无报错后，通过 ST-Link 连接小车主控板，将固件烧录至 STM32；
上电测试，确认各模块（OLED、LoRa、UWB）正常初始化。
上位机交互
上位机通过 LoRa 模块与小车建立无线通信（确认频段、波特率匹配）；
上位机下发目标位置坐标（格式需与小车解析模块约定，如X:XXX,Y:XXX）；
小车接收位置信息后，自动启动路径规划与导航，OLED 实时显示当前位置、目标位置、行驶状态。
功能说明
功能项	实现逻辑
位置定位	UWB 模块实时采集位置数据，通过串口 / IO 口传输至 STM32，解析为坐标系下的 XY 坐标
姿态检测	MPU6050 采集角速度、加速度数据，主控解算小车偏航角、俯仰角，用于路径修正
路径规划	A * 算法基于栅格地图（需提前配置），搜索从当前位置到目标位置的最优路径
电机控制	串级 PID 根据路径节点的速度 / 位置要求，输出 PWM 信号至 AT8236 驱动电机
状态显示	OLED 显示当前坐标、目标坐标、行驶速度、导航状态（导航中 / 已到达 / 异常）
异常处理	导航超时、定位丢失、电机堵转时，小车停止并在 OLED 提示异常类型
引脚配置（参考）
模块	引脚（STM32F103ZET6）	通信方式
OLED	SDA-PB7, SCL-PB6	IIC
LoRa	TX-PA9, RX-PA10	UART（USART1）
MPU6050	SDA-PB9, SCL-PB8	IIC
电机驱动 AT8236	PWM1-PA0, PWM2-PA1, PWM3-PA2, PWM4-PA3	TIM1_CH1~CH4
UWB 通信	TX-PA2, RX-PA3	UART（USART2）
注：实际引脚可根据硬件布局调整，需同步修改工程中gpio.h的引脚定义。
注意事项
UWB 定位校准：首次使用前需完成 UWB 基站布局与坐标校准，确保定位误差＜5cm；
PID 参数调优：不同载重、地面摩擦力下，需调整串级 PID 的比例（P）、积分（I）、微分（D）参数，保证电机控制的稳定性；
LoRa 通信：确保上位机与小车的 LoRa 模块频段、地址、波特率一致，避免通信丢包；
电源供电：电机驱动模块需独立供电（建议 12V），主控与外设使用 5V/3.3V 稳压电源，防止电压波动导致模块异常；
地图配置：A * 算法依赖栅格地图数据，需提前在代码中配置导航区域的栅格尺寸、障碍物位置。
常见问题
OLED 无显示：检查 IIC 引脚接线、OLED 供电、驱动初始化顺序；
导航偏差大：重新校准 UWB 定位、优化 PID 参数、检查 MPU6050 姿态解算精度；
LoRa 通信失败：检查串口波特率、模块供电、无线频段匹配度；
电机无响应：检查 AT8236 驱动使能引脚、PWM 输出是否正常、电机接线。
扩展方向
增加避障功能：集成超声波 / 激光雷达模块，在 A * 算法中加入动态避障逻辑；
多车协同：扩展 LoRa 通信协议，实现多台 AGV 小车的路径避撞与协同导航；
地图自构建：结合 SLAM 算法，实现小车自主构建导航地图，无需提前配置栅格地图；
远程控制：上位机增加手动控制模式，可临时接管小车行驶。
版本说明
版本	更新日期	更新内容
V1.0	-	基础版：实现定位、路径规划、PID 控制核心功能
